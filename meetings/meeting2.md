Q1. split Rzembedding forward pass into hashing and lookup. Note that in each forward pass there are two calls to rzembedding  as the model is a pair model

1CPU:

|    | Model          | sparse   |    bs |   mem_params |   forward(ms) |   hashing(ms) |   lookup(ms) |    other(ms) |   gradcomp(ms) |   backward(ms) |   total(ms) | msize   | optim   |
|----|----------------|----------|-------|--------------|---------------|---------------|--------------|--------------|----------------|----------------|-------------|---------|---------|
|  0 | FullEmbedding  | False    | 32768 |    100000000 |      10.7912  |      nan      |    nan       | nan          |       450.998  |      47.1732   |     508.962 | 381.5MB | sgd     |
|  1 | RobezEmbedding | False    | 32768 |       262144 |     131.652   |       55.4625 |      8.88706 |   0.00884331 |        28.7065 |       0.228669 |     160.588 | 1.0MB   | sgd     |
|  2 | RobezEmbedding | False    | 32768 |      2621440 |     149.468   |       56.8902 |     15.5968  |   0.00855646 |        42.6568 |       1.02921  |     193.154 | 10.0MB  | sgd     |
|  3 | RobezEmbedding | False    | 32768 |    100000000 |     145.07    |       49.8503 |     21.4939  |   0.00752562 |       417.488  |      33.8596   |     596.418 | 381.5MB | sgd     |
|  4 | FullEmbedding  | True     | 32768 |    100000000 |      12.198   |      nan      |    nan       | nan          |        30.7839 |     117.497    |     160.479 | 381.5MB | sgd     |
|  5 | RobezEmbedding | True     | 32768 |       262144 |     129.097   |       54.4456 |      8.88313 |   0.00769805 |       204.069  |       8.73508  |     341.902 | 1.0MB   | sgd     |
|  6 | RobezEmbedding | True     | 32768 |      2621440 |     140.562   |       53.47   |     15.5195  |   0.0108496  |       853.111  |      90.6529   |    1084.33  | 10.0MB  | sgd     |
|  7 | RobezEmbedding | True     | 32768 |    100000000 |     147.403   |       49.6475 |     22.2728  |   0.00782151 |      1739.76   |     330.293    |    2217.46  | 381.5MB | sgd     |
|  8 | FullEmbedding  | False    | 32768 |    100000000 |       8.92452 |      nan      |    nan       | nan          |       413.626  |     491.132    |     913.682 | 381.5MB | adagrad |
|  9 | RobezEmbedding | False    | 32768 |       262144 |     127.019   |       53.609  |      8.40189 |   0.00685879 |        27.2668 |       0.525868 |     154.812 | 1.0MB   | adagrad |
| 10 | RobezEmbedding | False    | 32768 |      2621440 |     136.589   |       51.5417 |     14.9777  |   0.00991406 |        40.0185 |       4.45595  |     181.064 | 10.0MB  | adagrad |
| 11 | RobezEmbedding | False    | 32768 |    100000000 |     147.155   |       49.9447 |     21.6998  |   0.00705676 |       417.245  |     492.239    |    1056.64  | 381.5MB | adagrad |
| 12 | FullEmbedding  | True     | 32768 |    100000000 |       8.84801 |      nan      |    nan       | nan          |        28.0109 |     249.913    |     286.772 | 381.5MB | adagrad |
| 13 | RobezEmbedding | True     | 32768 |       262144 |     127.649   |       53.6252 |      8.44796 |   0.00984807 |       192.46   |      25.7901   |     345.899 | 1.0MB   | adagrad |
| 14 | RobezEmbedding | True     | 32768 |      2621440 |     140.549   |       52.291  |     15.8925  |   0.00810676 |       865.916  |     272.439    |    1278.9   | 10.0MB  | adagrad |
| 15 | RobezEmbedding | True     | 32768 |    100000000 |     148.459   |       49.9658 |     22.4015  |   0.00737395 |      1780.17   |    1014.1      |    2942.74  | 381.5MB | adagrad |
| 16 | FullEmbedding  | False    | 32768 |    100000000 |       8.7951  |      nan      |    nan       | nan          |       402.417  |     672.184    |    1083.4   | 381.5MB | adam    |
| 17 | RobezEmbedding | False    | 32768 |       262144 |     127.888   |       53.7829 |      8.41261 |   0.00715522 |        27.85   |       0.792614 |     156.53  | 1.0MB   | adam    |
| 18 | RobezEmbedding | False    | 32768 |      2621440 |     137.541   |       51.736  |     15.2556  |   0.00727762 |        40.2056 |       7.50035  |     185.247 | 10.0MB  | adam    |
| 19 | RobezEmbedding | False    | 32768 |    100000000 |     147.656   |       49.8276 |     22.1715  |   0.0074261  |       422.979  |     685.629    |    1256.26  | 381.5MB | adam    |
| 20 | FullEmbedding  | True     | 32768 |    100000000 |      10.0032  |      nan      |    nan       | nan          |        30.4742 |     367.85     |     408.328 | 381.5MB | adam    |
| 21 | RobezEmbedding | True     | 32768 |       262144 |     128.059   |       53.8265 |      8.45524 |   0.00721695 |       195.835  |      35.6645   |     359.559 | 1.0MB   | adam    |
| 22 | RobezEmbedding | True     | 32768 |      2621440 |     138.546   |       51.9455 |     15.5097  |   0.00850271 |       858.497  |     382.406    |    1379.45  | 10.0MB  | adam    |
| 23 | RobezEmbedding | True     | 32768 |    100000000 |     147.107   |       49.6617 |     22.1279  |   0.00732552 |      1769.8    |    1418.97     |    3335.88  | 381.5MB | adam    |


10CPU

|    | Model          | sparse   |    bs |   mem_params |   forward(ms) |   hashing(ms) |   lookup(ms) |    other(ms) |   gradcomp(ms) |   backward(ms) |   total(ms) | msize   | optim   |
|----|----------------|----------|-------|--------------|---------------|---------------|--------------|--------------|----------------|----------------|-------------|---------|---------|
|  0 | FullEmbedding  | False    | 32768 |    100000000 |       2.49275 |     nan       |    nan       | nan          |       135.945  |      16.2308   |    154.669  | 381.5MB | sgd     |
|  1 | RobezEmbedding | False    | 32768 |       262144 |      18.1752  |       8.21322 |      1.11111 |   0.0057114  |        17.1154 |       0.204141 |     35.4948 | 1.0MB   | sgd     |
|  2 | RobezEmbedding | False    | 32768 |      2621440 |      21.701   |       8.3144  |      2.0438  |   0.00651606 |        27.8899 |       0.513515 |     50.1044 | 10.0MB  | sgd     |
|  3 | RobezEmbedding | False    | 32768 |    100000000 |      22.7962  |       8.09247 |      2.56371 |   0.00800831 |       168.95   |      17.9028   |    209.649  | 381.5MB | sgd     |
|  4 | FullEmbedding  | True     | 32768 |    100000000 |       3.17372 |     nan       |    nan       | nan          |        13.7981 |     128.952    |    145.924  | 381.5MB | sgd     |
|  5 | RobezEmbedding | True     | 32768 |       262144 |      19.2381  |       7.79891 |      1.29363 |   0.00559858 |       201.882  |       8.46239  |    229.583  | 1.0MB   | sgd     |
|  6 | RobezEmbedding | True     | 32768 |      2621440 |      22.0507  |       8.26733 |      2.2631  |   0.00864214 |       878.958  |      77.4078   |    978.417  | 10.0MB  | sgd     |
|  7 | RobezEmbedding | True     | 32768 |    100000000 |      19.2776  |       6.43685 |      2.73192 |   0.00868844 |      1810.81   |     255.924    |   2086.01   | 381.5MB | sgd     |
|  8 | FullEmbedding  | False    | 32768 |    100000000 |       2.40631 |     nan       |    nan       | nan          |       132.11   |     109.793    |    244.31   | 381.5MB | adagrad |
|  9 | RobezEmbedding | False    | 32768 |       262144 |      15.7226  |       6.41934 |      1.08469 |   0.0051111  |        12.16   |       0.377542 |     28.2602 | 1.0MB   | adagrad |
| 10 | RobezEmbedding | False    | 32768 |      2621440 |      20.5911  |       7.74344 |      2.10205 |   0.00673    |        26.0564 |       1.13045  |     47.778  | 10.0MB  | adagrad |
| 11 | RobezEmbedding | False    | 32768 |    100000000 |      20.0691  |       6.99083 |      2.56179 |   0.00747559 |       165.19   |     105.836    |    291.095  | 381.5MB | adagrad |
| 12 | FullEmbedding  | True     | 32768 |    100000000 |       2.48966 |     nan       |    nan       | nan          |        11.0059 |     252.419    |    265.915  | 381.5MB | adagrad |
| 13 | RobezEmbedding | True     | 32768 |       262144 |      16.7747  |       7.04414 |      1.15828 |   0.00639632 |       181.617  |      24.9452   |    223.337  | 1.0MB   | adagrad |
| 14 | RobezEmbedding | True     | 32768 |      2621440 |      17.9085  |       6.49099 |      1.99119 |   0.0071169  |       871.991  |     232.323    |   1122.22   | 10.0MB  | adagrad |
| 15 | RobezEmbedding | True     | 32768 |    100000000 |      19.3477  |       6.5586  |      2.75822 |   0.00793913 |      1789.32   |     804.45     |   2613.11   | 381.5MB | adagrad |
| 16 | FullEmbedding  | False    | 32768 |    100000000 |       7.06047 |     nan       |    nan       | nan          |       133.188  |     185.322    |    325.571  | 381.5MB | adam    |
| 17 | RobezEmbedding | False    | 32768 |       262144 |      15.9074  |       6.46792 |      1.08076 |   0.00578697 |        12.2413 |       0.476727 |     28.6254 | 1.0MB   | adam    |
| 18 | RobezEmbedding | False    | 32768 |      2621440 |      20.3194  |       7.73302 |      2.05931 |   0.00671617 |        26.0216 |       1.9779   |     48.3189 | 10.0MB  | adam    |
| 19 | RobezEmbedding | False    | 32768 |    100000000 |      33.9607  |      12.1034  |      3.45556 |   0.00679599 |       164.263  |     178.622    |    376.845  | 381.5MB | adam    |
| 20 | FullEmbedding  | True     | 32768 |    100000000 |       2.46666 |     nan       |    nan       | nan          |        11.9268 |     361.657    |    376.05   | 381.5MB | adam    |
| 21 | RobezEmbedding | True     | 32768 |       262144 |      19.8666  |       8.28094 |      1.28215 |   0.00545861 |       179.623  |      38.5777   |    238.068  | 1.0MB   | adam    |
| 22 | RobezEmbedding | True     | 32768 |      2621440 |      17.7857  |       6.54434 |      1.85567 |   0.00594716 |       863.555  |     316.202    |   1197.54   | 10.0MB  | adam    |
| 23 | RobezEmbedding | True     | 32768 |    100000000 |      18.812   |       6.19334 |      2.70119 |   0.00681888 |      1783.64   |    1108.6      |   2911.05   | 381.5MB | adam    |

